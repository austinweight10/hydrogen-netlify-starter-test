{"version":3,"file":"5202ea80.js","sources":["../../../src/components/elements/Grid.jsx","../../../src/components/product/ProductGrid.client.jsx"],"sourcesContent":["import clsx from 'clsx';\n\nexport function Grid({\n  as: Component = 'div',\n  className,\n  flow = 'row',\n  gap = 'default',\n  items = 4,\n  layout = 'default',\n  ...props\n}) {\n  const layouts = {\n    default: `grid-cols-1 ${items === 2 && 'md:grid-cols-2'}  ${\n      items === 3 && 'sm:grid-cols-3'\n    } ${items > 3 && 'md:grid-cols-3'} ${items >= 4 && 'lg:grid-cols-4'}`,\n    products: `grid-cols-2 ${items >= 3 && 'md:grid-cols-3'} ${\n      items >= 4 && 'lg:grid-cols-4'\n    }`,\n    auto: 'auto-cols-auto',\n    blog: `grid-cols-2 pt-24`,\n  };\n\n  const gaps = {\n    default: 'grid gap-2 gap-y-6 md:gap-4 lg:gap-6',\n    blog: 'grid gap-6',\n  };\n\n  const flows = {\n    row: 'grid-flow-row',\n    col: 'grid-flow-col',\n  };\n\n  const styles = clsx(flows[flow], gaps[gap], layouts[layout], className);\n\n  return <Component {...props} className={styles} />;\n}\n","import {useState, useRef, useEffect, useCallback} from 'react';\nimport {Link, flattenConnection} from '@shopify/hydrogen';\n\nimport {Button, Grid, ProductCard} from '~/components';\nimport {getImageLoadingPriority} from '~/lib/const';\n\nexport function ProductGrid({url, collection}) {\n  const nextButtonRef = useRef(null);\n  const initialProducts = collection?.products?.nodes || [];\n  const {hasNextPage, endCursor} = collection?.products?.pageInfo ?? {};\n  const [products, setProducts] = useState(initialProducts);\n  const [cursor, setCursor] = useState(endCursor ?? '');\n  const [nextPage, setNextPage] = useState(hasNextPage);\n  const [pending, setPending] = useState(false);\n  const haveProducts = initialProducts.length > 0;\n\n  const fetchProducts = useCallback(async () => {\n    setPending(true);\n    const postUrl = new URL(window.location.origin + url);\n    postUrl.searchParams.set('cursor', cursor);\n\n    const response = await fetch(postUrl, {\n      method: 'POST',\n    });\n    const {data} = await response.json();\n\n    // ProductGrid can paginate collection, products and search routes\n    // @ts-ignore TODO: Fix types\n    const newProducts = flattenConnection(\n      data?.collection?.products || data?.products || [],\n    );\n    const {endCursor, hasNextPage} = data?.collection?.products?.pageInfo ||\n      data?.products?.pageInfo || {endCursor: '', hasNextPage: false};\n\n    setProducts([...products, ...newProducts]);\n    setCursor(endCursor);\n    setNextPage(hasNextPage);\n    setPending(false);\n  }, [cursor, url, products]);\n\n  const handleIntersect = useCallback(\n    (entries) => {\n      entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n          fetchProducts();\n        }\n      });\n    },\n    [fetchProducts],\n  );\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(handleIntersect, {\n      rootMargin: '100%',\n    });\n\n    const nextButton = nextButtonRef.current;\n\n    if (nextButton) observer.observe(nextButton);\n\n    return () => {\n      if (nextButton) observer.unobserve(nextButton);\n    };\n  }, [nextButtonRef, cursor, handleIntersect]);\n\n  if (!haveProducts) {\n    return (\n      <>\n        <p>No products found on this collection</p>\n        <Link to=\"/products\">\n          <p className=\"underline\">Browse catalog</p>\n        </Link>\n      </>\n    );\n  }\n\n  return (\n    <>\n      <Grid layout=\"products\">\n        {products.map((product, i) => (\n          <ProductCard\n            key={product.id}\n            product={product}\n            loading={getImageLoadingPriority(i)}\n          />\n        ))}\n      </Grid>\n\n      {nextPage && (\n        <div\n          className=\"flex items-center justify-center mt-6\"\n          ref={nextButtonRef}\n        >\n          <Button\n            variant=\"secondary\"\n            disabled={pending}\n            onClick={fetchProducts}\n            width=\"full\"\n          >\n            {pending ? 'Loading...' : 'Load more products'}\n          </Button>\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":["as","Component","className","flow","gap","items","layout","props","layouts","default","products","auto","blog","gaps","styles","clsx","flows","row","col","url","collection","nextButtonRef","useRef","initialProducts","nodes","hasNextPage","endCursor","pageInfo","setProducts","useState","cursor","setCursor","nextPage","setNextPage","pending","setPending","haveProducts","length","fetchProducts","useCallback","postUrl","URL","window","location","origin","searchParams","set","response","fetch","method","data","json","newProducts","flattenConnection","handleIntersect","entries","forEach","entry","isIntersecting","useEffect","observer","IntersectionObserver","rootMargin","nextButton","current","observe","unobserve","_Fragment","_jsx","map","product","i","getImageLoadingPriority","id"],"mappings":"snBAEqB,WAAA,CACnBA,GAAIC,EAAY,MAChBC,YACAC,OAAO,MACPC,MAAM,UACNC,QAAQ,EACRC,SAAS,aACNC,GACF,CACD,KAAMC,GAAU,CACdC,QAAU,eAAcJ,IAAU,GAAK,qBACrCA,IAAU,GAAK,oBACbA,EAAQ,GAAK,oBAAoBA,GAAS,GAAK,mBACnDK,SAAW,eAAcL,GAAS,GAAK,oBACrCA,GAAS,GAAK,mBAEhBM,KAAM,iBACNC,KAAO,mBAAA,EAGHC,EAAO,CACXJ,QAAS,uCACTG,KAAM,YAAA,EAQFE,EAASC,EAAKC,AALN,CACZC,IAAK,gBACLC,IAAK,eAAA,EAGmBf,GAAOU,EAAKT,GAAMI,EAAQF,GAASJ,CAA1C,EAEnB,SAAQ,EAAD,CAAA,GAAeK,EAAO,UAAWO,CAAAA,CAAxC,CACD,CC7B2B,YAAA,CAACK,MAAKC,cAAa,WACvCC,KAAAA,GAAgBC,iBAAO,IAAD,EACtBC,EAAkBH,qBAAYV,WAAZU,cAAsBI,QAAS,CAAA,EACjD,CAACC,cAAaC,aAAaN,uBAAYV,WAAZU,cAAsBO,WAAtBP,OAAkC,GAC7D,CAACV,EAAUkB,GAAeC,EAAAA,QAAAA,SAASN,CAAD,EAClC,CAACO,EAAQC,GAAaF,EAAAA,QAAAA,SAASH,UAAa,EAAd,EAC9B,CAACM,EAAUC,GAAeJ,EAAAA,QAAAA,SAASJ,CAAD,EAClC,CAACS,EAASC,GAAcN,EAAAA,QAAAA,SAAS,EAAD,EAChCO,EAAeb,EAAgBc,OAAS,EAExCC,EAAgBC,EAAAA,QAAAA,YAAY,SAAY,aAC5CJ,EAAW,EAAD,EACV,KAAMK,GAAU,GAAIC,KAAIC,OAAOC,SAASC,OAASzB,CAAjC,EACR0B,EAAAA,aAAaC,IAAI,SAAUhB,CAAnC,EAEMiB,KAAAA,GAAW,KAAMC,OAAMR,EAAS,CACpCS,OAAQ,MAAA,CADkB,EAGtB,CAACC,QAAQ,KAAMH,GAASI,OAIxBC,EAAcC,EAClBH,qBAAM9B,aAAN8B,cAAkBxC,WAAYwC,kBAAMxC,WAAY,CAAA,CADb,EAG/B,CAACgB,UAAAA,EAAWD,YAAAA,GAAeyB,wBAAM9B,aAAN8B,cAAkBxC,WAAlBwC,cAA4BvB,WAC3DuB,qBAAMxC,WAANwC,cAAgBvB,WAAY,CAACD,UAAW,GAAID,YAAa,EAAA,EAE3DG,EAAY,CAAC,GAAGlB,EAAU,GAAG0C,CAAjB,CAAD,EACXrB,EAAUL,CAAD,EACTO,EAAYR,CAAD,EACXU,EAAW,EAAD,CACT,EAAA,CAACL,EAAQX,EAAKT,CAAd,CAtB8B,EAwB3B4C,EAAkBf,sBACrBgB,AAAY,GAAA,CACXA,EAAQC,QAASC,AAAU,GAAA,CACzB,AAAIA,EAAMC,gBACK,GACd,CAHH,CAAA,EAMF,CAACpB,CAAD,CARiC,EAyBnC,MAdAqB,GAAAA,QAAAA,UAAU,IAAM,CACRC,KAAAA,GAAW,GAAIC,sBAAqBP,EAAiB,CACzDQ,WAAY,MAAA,CADG,EAIXC,EAAa1C,EAAc2C,QAE7BD,MAAAA,IAAYH,EAASK,QAAQF,CAAjB,EAET,IAAM,CACPA,AAAAA,GAAYH,EAASM,UAAUH,CAAnB,CAAA,CAEjB,EAAA,CAAC1C,EAAeS,EAAQwB,CAAxB,CAZM,EAcL,AAAClB,IAYH+B,EAAA,CAAA,SAAA,CACEC,EAAC,EAAD,CAAM,OAAO,WAAb,SACG1D,EAAS2D,IAAI,CAACC,EAASC,MACrB,EAAD,CAEE,UACA,QAASC,EAAwBD,CAAD,CAAA,EAF3BD,EAAQG,EADf,CADD,CAAA,CAFL,EAWGzC,GACCoC,EAAA,MAAA,CACE,UAAU,wCACV,IAAK/C,EAFP,WAIG,EAAD,CACE,QAAQ,YACR,SAAUa,EACV,QAASI,EACT,MAAM,OAJR,SAMGJ,EAAU,aAAe,oBAAA,CAN5B,CAAA,CAhBN,CAAA,CAAA,CADF,IATIiC,EAAA,CAAA,SACE,CAAAC,EAAA,IAAA,CAAA,SAAA,sCAAA,CADF,EAEEA,EAAC,EAAD,CAAM,GAAG,YAAT,WACE,IAAA,CAAG,UAAU,YAAb,SAAA,gBAAA,CAAA,CAAA,CAHJ,CAAA,CAAA,CADF,CAuCH"}